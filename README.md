# Cavrtbany-X1 智能猫砂盆对接文档

## 回答20251104问题

```
1. 猫咪进入 -- 检测到大于800g且存在至少8秒,判断为:猫咪进入
2. 猫咪离开 -- 在猫咪进入的状态下,重量小于800g会判断为:猫咪离开
3. 猫咪如厕时长 -- DP8 的值+时间戳
4. 猫咪体重XXkg -- DP6的值+时间戳
   > 注意单位,硬件那边是g,目前在涂鸦后台的数据类型里设置为倍率为1
5. 清理开始 -- DP105=clear_star +时间戳
6. 清理结束 -- DP105=clear_end +时间戳
7. 集便仓满 --DP105=BOXFULL+时间戳
8. 清空开始 -- DP107=free_star +时间戳
9. 清空结束 -- DP107=free_end +时间戳
10. 童锁开启 -- DP109=true +时间戳
11. 童锁关闭 -- DP109=flase +时间戳
12. 指示灯开启 -- DP103=true +时间戳
13. 指示灯关闭 -- DP103=flase +时间戳
14. 电机故障 -- DP105=volt_err+时间戳
15. 顶盖不在位 -- DP105=MOTORCOVEROFF+时间戳
```
## 问题解答

**Q: 其中1、2不知道根据什么判断**

>  1. **猫咪进入** -- 检测到大于800g且存在至少8秒,判断为:猫咪进入
>  2. **猫咪离开** -- 在猫咪进入的状态下,重量小于800g会判断为:猫咪离开

---

**Q: 7、14、15因为时同一个故障DP，就算前后发生，最终展示的时间戳会一样，譬如故障110:00发生了，面板会记录10:00，故障1，故障1没有解决的情况下，11:00的时候故障2也发生了，设备是会重新报一下故障DP，并同时上报故障1+2，此时会显示11:00 故障1  故障2**


> 7、14、15不属于同一个DP
> 集便仓满属于状态, 由DP24管理,枚举值为`DEV_garbage_box_full`

  ```
  14和15分别对应着电机故障和顶盖不在位,由DP22管理,根据下面的bit值来判断,分别是:
  - bit0 垃圾盒满
  - bit1 电机故障
  - bit2 电机堵转
  - bit3 顶盖不在位
  - bit4 称重故障
  - bit5 电压异常
  - bit6 占位符
  - bit7 故障清理完成,不会触发故障警报
  ```


## 日志区域显示的全部内容

除`DP24`外,根据其他DP事件的变化,整理为可能出现的全部日志内容,其内容为:
```
1. 设备切换为自动模式
2. 设备切换为手动模式
3. 猫咪进来了
4. 猫咪离开了,本次排泄时长为xx秒
5. 检测到上次的猫咪的体重为xxkg
6. 清理等待时长设置为xx秒
7. 童锁模式设置为开
8. 童锁模式设置为关
9. 勿扰模式已打开,从xx日xx时xx分开始,到xx日xx时xx分结束
10. 勿扰模式已关闭
11. 设备遇到了故障:垃圾盒满
12. 设备遇到了故障:电机故障
13. 设备遇到了故障:电机堵转
14. 设备遇到了故障:顶盖不在位
15. 设备遇到了故障:称重故障
16. 设备遇到了故障:电压异常
17. 设备故障已解除,设备状态正常
18. 设备已恢复出厂设置
19. 指示灯已开启
20. 指示灯已关闭
21. 设备开始清理
22. 设备暂停清理
23. 设备结束清理
24. 设备开始清空
25. 设备暂停清空
26. 设备结束清空
27. 设备开始抚平猫砂
28. 设备暂停抚平猫砂
29. 设备结束抚平猫砂
```
## DP功能表

| DP ID | 功能点名称 | 标识符 | 数据传输类型 | 数据类型 | 功能点属性 | 备注 |
| ----- | -------- | ------------------- | ---------- | ----- | ------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 2 | 模式 | work_mode | 可下发可上报（rw） | enum | 枚举值: auto_clean, manual_clean | 自动模式，手动模式 |
| 5 | 清理等待时长 | delay_clean_time | 可下发可上报（rw） | value | 数值范围: 1-60,间距: 1, 倍数: 0,单位: 秒 | 设置延时清理时间即等待结团时间 |
| 6 | 猫咪体重 | cat_weight | 只上报（ro） | value | 数值范围: 0-300000,间距: 1, 倍数: 1,<br>单位: kg | 上报猫咪体重，支持多只猫咪称重,始终显示前一只猫咪的体重 |
| 7 | 今日排泄 | excretion_times_day | 只上报（ro） | value | 数值范围: 0-60,<br>间距: 1, 倍数: 0,<br>单位: times | 猫咪排泄后，设备端上报当天排泄总次数，APP端进行展示<br>无需判断0点的重置,软件程序 根据 硬件的上报信息即可 |
| 8 | 每次排泄时长 | excretion_time_day | 只上报（ro） | value | 数值范围: 0-600,<br>间距: 1, 倍数: 0,<br>单位: s | 猫咪排泄后，设备端上报当次排泄时长，每次排泄时长更新在工作日志中 |
| 9 | 童锁开关 | manual_clean | 可下发可上报（rw） | bool | | 选择打开或关闭童锁功能 |
| 10 | 勿扰模式 | sleep | 可下发可上报（rw） | bool | | 勿扰模式开关<br> |
| 11 | 勿扰模式开始时间 | sleep_start_time | 可下发可上报（rw） | value | 数值范围: 0-9999,<br>间距: 1, 倍数: 0, | 本地执行1次的静眠模式的开始时间，按时间转换位分钟下发，如。06：30，下发参数为6\*60+30=390 |
| 12 | 勿扰模式结束时间 | sleep_end_time | 可下发可上报（rw） | value | 数值范围: 0-9999,<br>间距: 1, 倍数: 0, | 本地执行1次的静眠模式的结束时间，按时间转换位分钟下发，如。06：30，下发参数为6\*60+30=390 |
| 14 | 重量校准 | uv_start_time | 可下发可上报（rw） | value | 数值范围: 0-15000,<br>间距: 1, 倍数: 0,<br>单位: g | 重量校准前需要先恢复出厂设置，放入已知重量的物体后，用户在app端输入重量数据完成校准。 |
| 22 | 故障告警 | fault | 只上报（ro） | fault | 故障值: BOXFULL, MOTORERR, MOTORSTUCK, MOTORCOVEROFF, MOTORSCALEERR, volt_err, wait6, clear_done | bit0垃圾盒满<br>bit1电机故障<br>bit2电机堵转<br>bit3顶盖不在位<br>bit4称重故障<br>bit5 电压异常<br>bit6 占位符<br>bit7清理完成这一条消息推送会报，故障不报 |
| 23 | 恢复出厂设置 | factory_reset | 可下发可上报（rw） | bool | | 设备端参数恢复到出厂设置，不影响wifi配置，APP打开会有相关确认提示 |
| 24 | 状态 | status | 可下发可上报（rw） | enum | 枚举值: standby, fault, waiting_cluster, cleaning, cleaning_pause, empty, empty_pause, garbage_box_full, cat_enter, sleep, check, check_pause | DEV_standby 0 待机中<br>DEV_fault 1 设备异常<br>DEV_waiting_cluster 2 等待结团<br>DEV_cleaning 3 清理中<br>DEV_cleaning_pause 4 清理暂停<br>DEV_empty 5 清空中<br>DEV_empty_pause 6 清空暂停<br>DEV_garbage_box_full 7 集便仓满<br>DEV_cat_enter 8 猫咪进入<br>DEV_sleep 9 勿扰模式中<br>DEV_check 10 自检中<br>DEV_check_pause 11 自检暂停 |
| 103 | 指示灯 | basic_indicator | 可下发可上报（rw） | bool | | 可选择开启或关闭设备指示灯。关闭指示灯时，设备正常工作和待机时不亮灯，故障时显示对应的灯光。 |
| 105 | 清理状态 | work_type | 可下发可上报（rw） | enum | 枚举值: clear_end, clear_star, clear_pause | clear_end：清空完成(清空stand_by) clear_star：清空中 clear_pause：清空暂停<br>点击"清理"按钮时，下发 work_type: 'clear_star'？ 是的,如果是自动模式下,点击后就会下发<br>点击"清理中"按钮暂停时，下发 work_type: 'clear_pause'？ 是的<br>点击"清理暂停"按钮继续时，再次下发 work_type: 'clear_star'？ 是的<br>当\`清理完成\`时候,接收到\`clear_end\`,恢复为\`清理\` |
| 107 | 清空状态 | relay_status | 可下发可上报（rw） | enum | 枚举值: free_end, free_star, free_pause | free_end：清空完成(清空)<br>free_star：清空中<br>free_pause：清空暂停 |
| 108 | 抚平猫砂 | mode | 可下发可上报（rw） | enum | 枚举值: end_flat, start_flat, pause_flat | end_flat=0完成<br>start=1开始<br>pause=2暂停 |

---

**更新时间：2025-11-04 06:59:56**